<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Not Analizi</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>
    <style>
      #dersSaati {
        width: 200px;
        margin-left: 180px;
        text-align: center;
        align-items: center;
        justify-content: center;
        display: flex;
      }
      .btn-custom {
        text-align: center;
        align-items: center;
        justify-content: center;
        display: flex;
        margin: auto;
        width: 200px;
        background-color: orangered;
        color: white;
      }
      .btn-custom:hover {
        background-color: darkorange;
        color: white;
        transition: 0.6s ease-in;
      }
      #sonuc {
        text-align: center;
        margin-top: 15px;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div class="container mt-5">
      <h2 class="text-center mb-4">Not Analizi</h2>
    </div>
    <div class="card p-4 shadow text-center mx-auto" style="max-width: 600px">
      <p>Kaç Saat Ders Çalıştınız?</p>
      <input
        type="number"
        id="dersSaati"
        class="form-control mb-3"
        placeholder="Ders Saati Girin"
      />
      <button id="analyzeBtn" class="btn btn-custom">Notu Analiz Et</button>
      <p id="sonuc"></p>
    </div>
    <div>
      <h6 style="text-align: center; margin-top: 10px">Eğitim Logları</h6>
      <div
        id="log"
        class="border rounded p-2 bg-light mt-3"
        style="
          height: 500px;
          max-height: 500px;
          overflow-y: auto;
          max-width: 600px;
          margin: auto;
        "
      ></div>
    </div>
  </body>
  <script>
    let model;
    const calisma_min = 1;
    const calisma_max = 15;
    function logMessage(message) {
      var log = document.getElementById("log");
      log.innerText += message + "\n";
      log.scrollTop = log.scrollHeight;
    }
    $(document).ready(function () {
      logMessage("Model hazırlanıyor...");
    });
    $(document).on("click", "#analyzeBtn", async function () {
      var model = tf.sequential();

      model.add(
        tf.layers.dense({
          units: 8,
          inputShape: [1],
          activation: "relu",
        })
      );
      model.add(
        tf.layers.dense({
          units: 4,
          activation: "relu",
        })
      );
      // çıktı katmanı
      model.add(
        tf.layers.dense({
          units: 3,
          activation: "softmax",
        })
      );
      model.compile({
        optimizer: tf.train.adam(0.01),
        loss: "categoricalCrossentropy",
        metrics: ["accuracy"],
      });
      //
      var inputs = tf.tensor2d([
        [1],
        [2],
        [1],
        [3],
        [2],
        [4],
        [5],
        [3],
        [1],
        [5],

        // Normal Başarı (6-10 Saat)
        [6],
        [7],
        [8],
        [9],
        [10],
        [6],
        [7],
        [8],
        [9],
        [10],

        // Yüksek Başarı (11-15 Saat)
        [11],
        [12],
        [13],
        [14],
        [15],
        [11],
        [12],
        [13],
        [14],
        [15],
      ]);
      var outputs = tf.tensor2d([
        // Başarısız (10 Örnek)
        [1, 0, 0],
        [1, 0, 0],
        [1, 0, 0],
        [1, 0, 0],
        [1, 0, 0],
        [1, 0, 0],
        [1, 0, 0],
        [1, 0, 0],
        [1, 0, 0],
        [1, 0, 0],

        // Normal (10 Örnek)
        [0, 1, 0],
        [0, 1, 0],
        [0, 1, 0],
        [0, 1, 0],
        [0, 1, 0],
        [0, 1, 0],
        [0, 1, 0],
        [0, 1, 0],
        [0, 1, 0],
        [0, 1, 0],

        // Başarılı (10 Örnek)
        [0, 0, 1],
        [0, 0, 1],
        [0, 0, 1],
        [0, 0, 1],
        [0, 0, 1],
        [0, 0, 1],
        [0, 0, 1],
        [0, 0, 1],
        [0, 0, 1],
        [0, 0, 1],
      ]);
      logMessage("Model eğitiliyor...");
      await model.fit(inputs, outputs, {
        epochs: 100,
        callbacks: {
          onEpochEnd: (epoch, logs) => {
            logMessage(
              `Epoch ${epoch + 1}: loss = ${logs.loss.toFixed(
                4
              )}, accuracy = ${logs.acc.toFixed(4)}`
            );
          },
        },
      });
      logMessage("Model eğitildi.");
      var dersSaati = parseFloat($("#dersSaati").val());
      var testValue = tf.tensor2d([[dersSaati]]);
      var prediction = model.predict(testValue);
      var results = await prediction.array();
      if (results[0][0] > results[0][1]) {
        if (results[0][0] > results[0][2]) {
          $("#sonuc").text(
            `Tahmin: Başarısız Not Alacaksınız. (Tahmin Doğruluk Oranı: ${(
              results[0][0] * 100
            ).toFixed(2)}%)`
          );
        } else {
          $("#sonuc").text(
            `Tahmin: Başarılı Not Alacaksınız. (Tahmin Doğruluk Oranı: ${(
              results[0][2] * 100
            ).toFixed(2)}%)`
          );
        }
      } else {
        if (results[0][1] > results[0][2]) {
          $("#sonuc").text(
            `Tahmin: Normal Not Alacaksınız. (Tahmin Doğruluk Oranı: ${(
              results[0][1] * 100
            ).toFixed(2)}%)`
          );
        } else {
          $("#sonuc").text(
            `Tahmin: Başarılı Not Alacaksınız. (Tahmin Doğruluk Oranı: ${(
              results[0][2] * 100
            ).toFixed(2)}%)`
          );
        }
      }

      console.log(results);
    });
  </script>
</html>
