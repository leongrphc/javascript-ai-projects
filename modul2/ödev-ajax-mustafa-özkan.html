<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ödev Mustafa Özkan</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
      crossorigin="anonymous"
    ></script>
  </head>
  <style>
    #yorumlariCek,
    #kaydet,
    #sil {
      padding: 10px 15px;
      border: none;
      border-radius: 5px;
      background-color: #08141f;
      color: white;
      font-size: 20px;
      margin: 5px;
    }
    #inputal,
    #endpoint {
      padding: 0 10px;
      justify-content: center;
      display: flex;
    }
    #endpoint button {
      margin-top: 10px;
      border: none;
      margin-left: 10px;
      border-radius: 5px;
      background-color: #08141f;
      color: white;
      font-size: 20px;
      padding: 10px;
    }
    #inputal button {
      border: none;
      margin-left: 10px;
      border-radius: 5px;
      background-color: #08141f;
      color: white;
      font-size: 20px;
    }
    #yorum-input {
      outline: none;
      height: 40px;
      width: 400px;
      border: none;
      text-align: center;
      font-size: 20px;
      background-color: rgb(221, 221, 220);
    }
  </style>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
    crossorigin="anonymous"
  />
  <body>
    <h4>
      SEÇİM YAPIN : <button id="yorumlariCek">Yorumları Getir</button>
      <button id="kaydet">Local'e Kaydet</button>
      <button id="sil">Local'den Sil</button>
    </h4>
    <h5>
      <div id="inputal">
        <input type="text" id="yorum-input" placeholder="Yorumunuzu yazın..." />
        <button id="yorum-ekle">Yorumu Ekle</button>
        <button id="yorum-sil">En üstteki yorumu Sil</button>
      </div>
      <div id="endpoint">
        <button id="sendAi">Yapay Zekaya Gönder</button>
      </div>
    </h5>

    <div id="comments" class="mb-3">
      <table class="table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Email</th>
            <th>İsim</th>
            <th>Yorum</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </body>
  <script>
    // Jsonplaceholder sitesindeki örnek get endpointlerinden data alın. Bu datayı döngüler ile localstorage içine kayıt edin. Daha sonra kullanıcı tarafında bir textbox ve buton koyup yeni eklenen dataları da localstorage içine kayıt edin. Ardından yapay zekaya gönder butonu oluşturup bu dataları bir endpointe post edicek kodu yazın.
    function yorumlariCek(users) {
      var yorumlar = $(".table tbody");
      yorumlar.empty();

      users.forEach(function (yorum) {
        yorumlar.append(
          `
                <tr>
                <td id="yorum-id">${yorum.id}</td>
                <td id="yorum-email">${yorum.email}</td>
                <td id="yorum-name">${yorum.name}</td>
                <td id="yorum-body">${yorum.body}</td>
                </tr>
    
            `
        );
      });
    }
    $(document).on("click", "#yorumlariCek", function () {
      $.ajax({
        url: "https://jsonplaceholder.typicode.com/comments",
        dataType: "json",
        beforeSend: function () {
          alert("Yorumlar getiriliyor...");
        },
        success: function (data) {
          yorumlariCek(data);
        },
        error: function (xhr, error, status) {
          console.log("hata oluştu:", error);
        },
      });
    });

    $(document).on("click", "#kaydet", function () {
      $("#comments tbody tr").each(function () {
        var id = $(this).find("#yorum-id").text();
        var yorum = $(this).find("#yorum-body").text();
        localStorage.setItem(id, yorum);
      });
    });
    $(document).on("click", "#sil", function () {
      localStorage.clear();
    });
    $(document).on("click", "#yorum-ekle", function () {
      var yeniYorum = $("#yorum-input").val();
      var yorumlar = $(".table tbody");
      yorumlar.prepend(
        `
        <tr>
          <td id="yorum-id">${Date.now()}</td>
          <td id="yorum-email">blabla@admin.com</td>
          <td id="yorum-name">Admin</td>
          <td id="yorum-body">${yeniYorum}</td>
        </tr>
      `
      );
    });
    $(document).on("click", "#yorum-sil", function () {
      $(".table tbody tr").first().remove();
    });
    $(document).on("click", "#sendAi", function () {
      var veri = [];
      for (var i = 0; i < localStorage.length; i++) {
        var key = localStorage.key(i);
        var value = localStorage.getItem(key);
        veri.push({ id: key, yorum: value });
      }
      console.log(veri);
      $.ajax({
        url: "http://localhost:2222/api/users", // local api kurup konsolda test ettim çalışıyor.
        type: "POST",
        dataType: "json",
        contentType: "application/json",
        data: JSON.stringify({ yorumlar: veri }),
        success: function (response) {
          console.log("Yorumlar yapay zekaya gönderildi:", response);
        },
        error: function (xhr, status, error) {
          console.log("Hata oluştu:", error);
        },
      });
    });
  </script>
</html>
